/**
 * jquery.rangecalendar.js v 1.0.2
 * Copyright 2013, Angelo Libero Mangieri
 * Email: angelo@afreeux.com
 */
(function(b,a,c){b.fn.rangeCalendar=function(d){var f={lang:"ko",theme:"default-theme",themeContext:this,startDate:moment(),endDate:moment().add(12,"months"),start:"+7",startRangeWidth:7,minRangeWidth:1,maxRangeWidth:14,weekends:true,autoHideMonths:false,visible:true,trigger:null,changeRangeCallback:function(h,g,i){return false}};var e;this.each(function(h,k){var l=k,g=b(k),j=b.extend(true,{},f,d);l.options=j;l.showCalendar=function(o){var n=l.calendarObj.position();var i=l.calendarObj.find(".cell").last().position();var p=(i.left+l.calendarObj.find(".cell").last().outerWidth());var m=l.calendarObj.find(".cell").eq(0).position();g.slideDown((o?300:0),function(){var q=b(a).outerWidth();b(l.calendarObj).css({left:q});b(l.monthsObj).css({left:q});l._placeElement(l.calendarObj,(!m?0:m.left));l._placeElement(l.monthsObj)});l.visible=true},l.hideCalendar=function(){g.slideUp(50);l.visible=false},l.toggleCalendar=function(){if(l.visible){l.showCalendar()}else{l.hideCalendar()}},l.rangeWidth=function(){var m=l.calendarObj.find(".cell").outerWidth();var i=parseInt(l.calendarObj.find(".range-bar").outerWidth()/m);l._rangeWidth=(!i?l._rangeWidth:i);return l._rangeWidth},l.setRangeWidth=function(i){var n=l.calendarObj.find(".cal-cell").eq(0).outerWidth();var m=parseInt(!i||i<l.minRangeWidth?l.minRangeWidth:i);g.find(".range-bar").width(n*m);g.find(".range-bar").trigger("resize")},l.range=function(){var n=l.calendarObj.find(".cell.selected:eq(0)").index();var o=l.calendarObj.find(".cell.selected").last().index();var p=(n>=0?moment(l.calendarObj.find(".cell.selected:eq(0)").attr("date-id"),"YYYYMMDD").format():null);var m=(o>=0?moment(l.calendarObj.find(".cell.selected").last().attr("date-id"),"YYYYMMDD").format():null);var i=b.data(l,"range",{start:p,end:m,width:l.rangeWidth()});return i},l.setStartDate=function(i){var o=moment(i);var s=o.format("YYYY");var r=o.format("MM");var t=o.format("D");var m=s+r+t;var n=s+r;var p=l.calendarObj.find('.cell[date-id="'+m+'"]').eq(0);p.trigger("click");var q=l.monthsObj.find('.cell[month-id="'+n+'"]').eq(0);q.trigger("click")},l.lang=function(){return l.lang},l.setTheme=function(m){var i=b(l.themeContext).attr("theme");if(i){b(l.themeContext).removeClass(i)}b(l.themeContext).attr("theme",m);b(l.themeContext).addClass(m);l.theme=m},l.update=function(i,m){l.startDate=i;l.endDate=m;moment.locale(l.lang);l.setTheme(l.theme);l._generateView(i,m)},l.didResizeBar=function(){var n=l.rangeWidth();var s=n;var t=l.calendarObj.find(".range-bar").position();var p=l.calendarObj.find(".range-bar").outerWidth();var o=t.left+p;var m=b(l).find(".cell").first().outerWidth();var i=b(l).find(".cell").last().position();var r=0;var q=(i.left+m);if(o>q){r=q-p;n=(p-r)/m}l.calendarObj.find(".cell").removeClass("selected");l.calendarObj.find(".cell").removeClass("last");l.calendarObj.find(".cell.start").addClass("selected");l.calendarObj.find(".cell.start").nextAll().slice(0,(!s?l.minRangeWidth-1:s-1)).addClass("selected");l.calendarObj.find(".cell.selected").last().addClass("last");l._dispatchEvent(l.changeRangeCallback,l.range(),l)},l.didSelectMonth=function(o){if(l.isDragging||b(l.lastTarget).is(l.monthsObj)){delete l.lastTarget;return}var n=b(this).attr("month-id");var p=l.calendarObj.find('.cell[month-id="'+n+'"].selected').eq(0);var m=(!p.length?l.calendarObj.find('.cell[month-id="'+n+'"]').eq(0).position():p.position());var i=b(g).outerWidth();l.monthsObj.find(".cell").not(this).removeClass("selected");b(this).addClass("selected");l._placeElement(l.calendarObj,m);l._dispatchEvent(l.changeRangeCallback,l.range(),l)},l.didChangeRange=function(p,o){if(l.isDragging||b(l.lastTarget).is(l.calendarObj)){delete l.lastTarget;return}var m=l.rangeWidth();var r=b(this);var n=l.calendarObj.find(".cell").last();var q=n.index()-r.index();var i=r.index()+m-1;if(i>n.index()){l.calendarObj.find(".cell").eq(r.index()-m+q+1).trigger("click");return}l.calendarObj.find(".start").removeClass("start");r.addClass("start");l._updateRangeBar();l._updateMonths();l._dispatchEvent(l.changeRangeCallback,l.range(),l)},l._initRangeBar=function(){b(a).unbind("resize");var n=l.rangeWidth();var o=l.calendarObj.find(".cell").eq(0).outerWidth();var i=l.calendarObj.find(".cell").eq(0).outerHeight();var m=l.calendarObj.find(".cell.selected:eq(0)");if(!m.length){return}l.calendarObj.find(".range-bar").unbind("resize");l.calendarObj.find(".range-bar").remove();b(m).append('<div class="range-bar resizable"><div class="range-bar-content"></div></div>');if(l.maxRangeWidth>1){l.calendarObj.find(".range-bar").resizable({grid:[o,0],maxWidth:l.maxRangeWidth*o,minWidth:o*l.minRangeWidth,maxHeight:i,minHeight:i,handles:"e"})}l.setRangeWidth(n);l.calendarObj.find(".range-bar").on("resize",l.didResizeBar);b(a).bind("resize",l._resize)},l._initMonths=function(){l.monthsObj.draggable({axis:"x",scrollSensitivity:100,scrollSpeed:100,cursor:"move",create:function(m,i){l._updateMonths();l._placeElement(l.monthsObj)},start:function(m,i){l.isDragging=true;l.monthsObj.find(".cell").unbind("click")},drag:function(m,i){},stop:function(m,i){b(this).css({top:0});l.lastTarget=m.target;setTimeout(function(){l.isDragging=false;delete l.lastTarget;l._placeElement(l.monthsObj);l.monthsObj.find(".cell").bind("click",l.didSelectMonth)},10)}})},l._initCalendar=function(){var i;l.calendarObj.draggable({axis:"x",scrollSensitivity:100,scrollSpeed:100,cursor:"move",create:function(){var n=moment(l.startDate);n.add(3,"months");l.calendarObj.find(".cell").removeClass("selected");l.calendarObj.find(".cell").removeClass("last");var m=n.format("YYYYMMD");l.calendarObj.find('.cell[date-id="'+m+'"]').addClass("start");l.calendarObj.find('.cell[date-id="'+m+'"]').addClass("selected");l.calendarObj.find(".cell.start").nextAll().slice(0,l._rangeWidth-1).addClass("selected");l.calendarObj.find(".cell").bind("click",l.didChangeRange);l.calendarObj.find(".cell.selected").last().addClass("last");var p=n.format("YYYYMM");var q=l.calendarObj.find('.cell[month-id="'+p+'"].selected').eq(0).prev().prev().prev().prev().prev();var o=(!q.length?l.calendarObj.find('.cell[month-id="'+p+'"]').eq(0).position():q.position());l._placeElement(l.calendarObj,o)},start:function(n,m){i=m.position.left;b(a).unbind("resize");l.isDragging=true;l.calendarObj.find(".cell").unbind("click")},drag:function(C,v){var y=v.position.left-i;var E=y>=0?"right":"left";var p=g.outerWidth();var q=l.calendarObj.position();var z=parseInt(l.monthsObj.find(".cell").last().attr("month-id"));var r=parseInt(l.monthsObj.find(".cell").first().attr("month-id"));var u=parseInt(l.monthsObj.find(".cell.selected").attr("month-id"));var n=parseInt(l.monthsObj.find(".cell.selected").next().attr("month-id"));var o=parseInt(l.monthsObj.find(".cell.selected").prev().attr("month-id"));if(n&&u&&n<=z&&E=="left"){var A=l.monthsObj.find('.cell[month-id="'+n+'"]');var w=l.calendarObj.find('.cell[month-id="'+n+'"]').first();var x=w.position();var m=(p/2-(x.left));if(m>=q.left&&q.left!==0){l.monthsObj.find(".cell").removeClass("selected");b(A).addClass("selected");l._placeElement(l.monthsObj,A.position())}}else{if(o&&u&&o>=r&&E=="right"){var B=l.monthsObj.find('.cell[month-id="'+o+'"]');var t=l.calendarObj.find('.cell[month-id="'+o+'"]').last();var s=t.position();var D=(p/2-(s.left));if(D<=q.left+t.outerWidth()){l.monthsObj.find(".cell").removeClass("selected");b(B).addClass("selected");l._placeElement(l.monthsObj,B.position())}}}},stop:function(n,m){l.lastTarget=n.target;l._placeElement(l.calendarObj);setTimeout(function(){l.isDragging=false;delete l.lastTarget;l.calendarObj.find(".cell").bind("click",l.didChangeRange);b(a).bind("resize",l._resize);l._placeElement(l.monthsObj)},100)}})},l._attachDragEasing=function(q){return;var n=b(q);var m,i,v,u,t,r,w=40,p=10;var o=function(y){var x=n.data("mouseEvents");if(y.timeStamp-x[x.length-1].timeStamp>40){x.push(y);if(x.length>2){x.shift()}}};var s=function(){};n.bind("dragstart",function(x){n.data("mouseEvents",[x]);b(document).mousemove(o).mouseup(s)});n.bind("dragstop",function(F){n.stop();var G=n.data("mouseEvents").shift();m=G.pageX;v=G.pageY;t=G.timeStamp;i=F.pageX;u=F.pageY;r=F.timeStamp;var A=i-m,z=u-v,H=Math.max(r-t,1);var E=Math.max(Math.min(A/H,1),-1),D=Math.max(Math.min(z/H,1),-1);var y=Math.sqrt(Math.pow(m-i,2)+Math.pow(v-u,2));if(y>w){var B=new Date();var x=b(a).width()-(n.width()+10),C=0;n.animate({textIndent:0},{duration:Math.max(Math.abs(E),Math.abs(D))*2000,step:function(L){E*=(L/100);D*=(L/100);var K=new Date();var M=K.getTime()-B.getTime();B=K;var I=n.position();var N=(I.left+(E*M/p)),J=(I.top+(D*M/p));N=N>x?x:N<10?10:N;J=J>C?C:J<10?10:J;n.css({left:N+"px",top:0+"px"})}})}})},l._getCalendarHTML=function(i,o){var n="";var w;var m=moment(i).set("date",1);var v=moment(o).set("date",moment(o).daysInMonth());var z=l.rangeWidth();for(var p=1;(m.isBefore(v)||m.isSame(v));p++){var y=m.format("YYYY");var q=m.format("MMM");var u=m.format("MM");var s=m.format("ddd");var x=m.format("d");var t="";var B="";if(x=="0"){t="sunday";B="sunday"}if(x=="6"){t="saturday";B="saturday"}if(m.format("YYYYMMDD")==moment().format("YYYYMMDD")){t="today";B="today"}var A=m.format("D");var r=m.day()%6===0;if(r&&!l.weekends){m.add(1,"days");continue}w='<div class="cal-cell cell" date-id="'+y+u+A+'" month-id="'+y+""+u+'" month="'+u+'">';w+='<div class="cell-content">';w+='<div class="day-number '+t+'">'+A+"</div>";w+='<div class="day '+B+'">'+s+"</div>";w+="</div>";w+="</div>";n+=w;m.add(1,"days")}return n},l._getMonthsHTML=function(i,n){var r="";var u;var m=moment(i).set("date",1);var t=moment(n).set("date",moment(n).daysInMonth());for(var o=1;(m.isBefore(t)||m.isSame(t));o++){var q=m.format("YY");var v=m.format("YYYY");var p=m.format("MMM");var s=m.format("MM");u='<div class="month-cell cell" month-id="'+v+""+s+'" month="'+s+'">';u+='<i class="bullet"></i>';u+='<div class="date-formatted"><span class="month-name">'+p+"</span> "+v+"</span></div>";u+="</div>";r+=u;m.add(1,"month")}return r},l._updateMonths=function(){var i=l.calendarObj.find(".cell.selected:eq(0)").attr("month-id");l.monthsObj.find(".cell").removeClass("selected");l.monthsObj.find(".cell").removeClass("current");l.monthsObj.find('.cell[month-id="'+i+'"]').addClass("selected");l.monthsObj.find('.cell[month-id="'+i+'"]').addClass("current")},l._updateRangeBar=function(){l.didResizeBar();l._initRangeBar()},l._dispatchEvent=function(n,i,m){if(!n){return false}n(m,i)},l._placeElement=function(i){l._placeElement(i,null)},l._placeElement=function(p,m){var q=g.outerWidth();var o=b(p).find(".cell").first().outerWidth();var r=b(p).children().length;var i=(r*o);var n=b(p).position();left=(!m?parseInt(n.left):-m.left);if(q>i){left=(q-i)/2}else{if(q<i&&left>=0){left=0}else{if(left<q-i){left=-i+q}}}b(p).stop().animate({left:left},300,"easeOutCirc")},l._timedResize=function(){clearTimeout(l.resizeTimer);l.resizeTimer=setTimeout(l._resize,l.timeoutTime)},l._bindEvents=function(){if(l.trigger){b(l.trigger).unbind("click");b(l.trigger).click(l.toggleCalendar)}l.timeout=false;l.timeoutTime=100;l.calendarObj.find(".range-bar").on("resize",l.didResizeBar);l.monthsObj.find(".cell").bind("click",l.didSelectMonth);b(a).bind("resize",l._timedResize);g.hover(function(){if(l.autoHideMonths){l.monthsObj.slideDown(100,"easeOutCirc")}},function(){if(l.autoHideMonths){l.monthsObj.slideUp(0,"easeOutCirc")}});b(l).on("mousedown",".range-bar",function(i){var m=document.elementFromPoint(i.clientX,i.clientY);if(b(m).hasClass("ui-resizable-handle")){i.stopPropagation();return false}});b(l).on("mouseup",".range-bar",function(m){if(b(l).find(".range-bar").hasClass("ui-resizable-resizing")){return true}b(this).hide();var i=document.elementFromPoint(m.clientX,m.clientY);b(this).show();b(i).trigger("click");return true})},l._resize=function(){l._placeElement(l.calendarObj);l._placeElement(l.monthsObj);l.timeout=false},l._updateView=function(i,m){l.calendarObj.append(l._getCalendarHTML(i,m));l.monthsObj.append(l._getMonthsHTML(i,m));if(l.visible){g.css({display:"block"});l.showCalendar()}else{g.css({display:"none"})}l._initCalendar();l._initMonths();l._initRangeBar();l._attachDragEasing(l.calendarObj)},l._generateView=function(i,n){var m="range-calendar";g.removeClass(m);g.addClass(m);g.empty();l.monthsObj=b('<div class="wrapper"><div class="months"></div></div>');g.append(l.monthsObj);l.monthsObj=l.monthsObj.find(".months");if(l.autoHideMonths){l.monthsObj.addClass("auto-hide-months")}l.calendarObj=b('<div class="wrapper"><div class="calendar"></div></div>');g.append(l.calendarObj);l.calendarObj=l.calendarObj.find(".calendar");l._updateView(i,n);l._bindEvents();l._dispatchEvent(l.changeRangeCallback,l.range(),l)},l._init=function(m,i){l.themeContext=i.themeContext;l.lang=i.lang;l.isDragging=false;l.minRangeWidth=i.minRangeWidth;l.maxRangeWidth=i.maxRangeWidth;l.weekends=i.weekends;l.startDate=i.startDate;l.endDate=i.endDate;l.start=(!i.start?"+7":parseInt(i.start));l.startRangeWidth=(i.startRangeWidth>i.maxRangeWidth?i.maxRangeWidth:i.startRangeWidth);l._rangeWidth=l.startRangeWidth;l.trigger=i.trigger;l.visible=i.visible;l.changeRangeCallback=i.changeRangeCallback;l.autoHideMonths=i.autoHideMonths;l.theme=(i.theme?i.theme:f.theme);l.update(l.startDate,l.endDate)},l._init(k,l.options);b(l).data("rangeCalendar",l)});return this.data("rangeCalendar")}})(jQuery,window);